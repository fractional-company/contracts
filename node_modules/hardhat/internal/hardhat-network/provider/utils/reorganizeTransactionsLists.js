"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.reorganizeTransactionsLists = void 0;
const errors_1 = require("../errors");
const PoolState_1 = require("../PoolState");
// tslint:disable only-hardhat-error
/**
 * Move as many transactions as possible from the queued list
 * to the pending list.
 *
 * Returns the new lists and the new executable nonce of the sender.
 */
function reorganizeTransactionsLists(pending, queued) {
    let newPending = pending;
    let newQueued = queued.sortBy(PoolState_1.retrieveNonce, (l, r) => l.cmp(r));
    let executableNonce;
    if (pending.last() === undefined) {
        throw new errors_1.InternalError("Pending list cannot be empty");
    }
    executableNonce = PoolState_1.retrieveNonce(pending.last()).addn(1);
    let movedCount = 0;
    for (const queuedTx of newQueued) {
        const queuedTxNonce = PoolState_1.retrieveNonce(queuedTx);
        if (executableNonce.eq(queuedTxNonce)) {
            newPending = newPending.push(queuedTx);
            executableNonce.iaddn(1);
            movedCount++;
        }
        else {
            break;
        }
    }
    newQueued = newQueued.skip(movedCount);
    return {
        newPending,
        newQueued,
    };
}
exports.reorganizeTransactionsLists = reorganizeTransactionsLists;
//# sourceMappingURL=reorganizeTransactionsLists.js.map